---
title: "p8105_hw5_Ic3391.Rmd"
author: "Lu Chen"
date: "11/10/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

```

## Problem 1 
```{r}
library(tidyverse)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

# replacing missing values for both numeric and character variables

na_replace = function(vec) {
  if (is.numeric(vec)) {
    vec = replace(vec, is.na(vec), round(mean(vec, na.rm = TRUE)))
  }
  else if (is.character(vec)) {
    vec = replace(vec, is.na(vec), "virginica")
  }
  vec #return the resulting vector
}

map (iris_with_missing,na_replace)

```

## Problem 2
```{r warning=FALSE}
tibble(list.files(path = "./data")) %>% 
  rename(id_and_arm = `list.files(path = "./data")`) %>% 
  mutate(tran = "./data/", change_wd = str_c(tran, id_and_arm) ,data = map(change_wd, read.csv)) %>% 
  unnest() %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "value"
    ) %>% 
  subset.data.frame(select = c("id_and_arm","week","value")) %>% 
  ggplot(aes(x = week, y = value, group = id_and_arm, color = id_and_arm)) +
  geom_line() +
  facet_grid(.~id_and_arm) +
  labs(
    title = "Observations over time",
    x = "Week", 
    y = "Value"
    ) 

#comments: In general, the experiment group receives higher value compared to the control group.Participants in the experiment group have a great improvement in values at certain observation time period.
  
```

## Problem 3
```{r}
#hypothesis testing

sim_regression = function(n=30, beta0=2, beta1=0){
  sim_data = tibble(
    x = rnorm(n, mean = 1, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, 0, 50)
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta1_hat = coef(ls_fit)[2],
    p_value = broom::tidy(ls_fit)[[2,5]]
  )
}

sim_regression()

sim_results_0 = 
  rerun(10000, sim_regression(30, 2, 0)) %>% 
  bind_rows()

sim_results_0

sim_results_1 = 
  rerun(10000, sim_regression(30, 2, 1)) %>% 
  bind_rows()

sim_results_1

sim_results_2 = 
  rerun(10000, sim_regression(30, 2, 2)) %>% 
  bind_rows()

sim_results_2

sim_results_3 = 
  rerun(10000, sim_regression(30, 2, 3)) %>% 
  bind_rows()

sim_results_3

sim_results_4 = 
  rerun(10000, sim_regression(30, 2, 4)) %>% 
  bind_rows()

sim_results_4

sim_results_5 = 
  rerun(10000, sim_regression(30, 2, 5)) %>% 
  bind_rows()

sim_results_5

sim_results_6 = 
  rerun(10000, sim_regression(30, 2, 6)) %>% 
  bind_rows()

sim_results_6
```

